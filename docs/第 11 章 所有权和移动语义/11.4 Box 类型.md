### 11.4 Box 类型

Box 类型是 Rust 中一种常用的指针类型。它代表“拥有所有权的指针”，类似于 C++ 里面的`unique_ptr`（严格来说，`unique_ptr<T>`更像 `Option<Box<T>>`）。用法如下：

---

```rust
struct T{
    value: i32
}

fn main() {
    let p = Box::new(T{value: 1});
    println!("{}", p.value);
}
```

---

Box 类型永远执行的是 move 语义，不能是 copy 语义。原因大家想想就可以明白，Rust 中的 copy 语义就是浅复制。对于 Box 这样的类型而言，浅复制必然会造成二次释放问题。

对于 Rust 里面的所有变量，在使用前一定要合理初始化，否则会出现编译错误。对于`Box<T>/&T/&mut T` 这样的类型，合理初始化意味着它一定指向了某个具体的对象，不可能是空。如果用户确实需要“可能为空的”指针，必须使用类型`Option<Box<T>>`。

Rust 里面还有一个保留关键字 box（注意是小写）。它可以用于把变量“装箱”到堆上。目前这个语法依然是 unstable 状态，需要打开 feature gate 才能使用，示例如下：

---

```rust
#![feature(box_syntax)]

struct T{
    value: i32
}

fn main() {
    let p : Box<T> = box T{value: 1};
    println!("{}", p.value);
}
```

---

这种写法和 Box::new()函数调用并没有本质区别。将来 box 关键字可能会同样支持各种智能指针，从而根据上下文信息自动判断执行。比如`let p:Rc<T>=box T{value：1};`就可以构造一个 Rc 指针。
